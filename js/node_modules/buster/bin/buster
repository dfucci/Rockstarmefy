#!/usr/bin/env node

var fs = require("fs");
var childProcess = require("child_process");

var argv = Array.prototype.slice.call(process.argv).slice(2)
var cmd = argv.shift();

var cmdExists = childProcess.exec(
    "command -v buster-" + cmd,
    {env: process.env},
    function (error, stdout, stderr) {
        if (error) {
            if (error.code == 1) {
                console.log("Buster command '" + cmd + "' does not exist.");
            } else {
                console.log("Unknown error occurred when running wrapper script.");
                console.log("Try using buster-server, buster-test etc directly.");
            }
        } else {
            var mod = stdout.split("\n")[0];

            var run = childProcess.spawn(mod, argv, {env: process.env, setsid: true});
            run.stdout.on('data', function (data) {
                process.stdout.write(data);
            });

            run.stderr.on('data', function (data) {
                process.stderr.write(data);
            });

            run.on('exit', function (code) {
                process.exit(code);
            });
        }
    }
);
